
####################################################################
# Mvn - add terminal-notifications                                 #
# see https://github.com/geoffreywiseman/maven-notification-center #
####################################################################

# Send a Notification to Notification Centre
function maven_notify {
  local _project=${PWD##*/}
  local _subtitle="in $_project"
  local _title
  local _message

  if [ $1 -eq 0 ]; then
    _title="Build Successful"
    _message="Build succeeded in ${_project}; click to return."
  else
    _title="Build Failed"
    _message="Build failed in ${_project}; click to return."
  fi
  terminal-notifier -title "${_title}" -subtitle "${_subtitle}" -message "${_message}" -group ${_project} `activate_term_program`
}

# return terminal in which this is running
function activate_term_program {
  local _result

  if [ ${TERM_PROGRAM} = "Apple_Terminal" ]; then
    _result="-sender com.apple.Terminal"
  elif [ ${TERM_PROGRAM} = "iTerm.app" ]; then
    _result="-sender com.googlecode.iterm2"
  else
    _result=""
  fi
  return $_result
}

#re-register mvn
alias maven="command mvn"
function notified_maven() {
  # make sure maven does not steal focus when forking processes
  PRE_JAVA_OPTIONS="$_JAVA_OPTIONS"
  export _JAVA_OPTIONS="$_JAVA_OPTIONS -Djava.awt.headless=true"

  if [ -n "hash terminal-notifier 2>/dev/null" ];
    then
      maven $*
      maven_notify $?
    else
      maven $*
  fi
  export _JAVA_OPTIONS="$PRE_JAVA_OPTIONS"
}
alias mvn=notified_maven
